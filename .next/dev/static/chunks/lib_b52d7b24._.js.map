{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/VICTUS/Desktop/aaaaa/lib/csv-service.ts"],"sourcesContent":["// Google Sheets CSV fetching and parsing service\n\nconst CSV_URL =\n  \"https://docs.google.com/spreadsheets/d/e/2PACX-1vSoUrbuhtYLt8rgvqUa50dR1t8xYvrZvIZE0HXP3otUOEKICNi52AaKMs1W_sKcnTEsJlYNnRRcq1Qr/pub?gid=0&single=true&output=csv\"\n\nexport interface CSVUser {\n  email: string\n  password: string\n  name: string\n  status: string\n  contact: string\n  phone: string // Added phone field to store phone numbers\n}\n\nexport interface ParsedUser {\n  email: string\n  password: string\n  name: string\n  status: \"online\" | \"offline\" | \"busy\"\n  phone: string // Changed from contacts array to single phone field\n}\n\n// Parse CSV text into records - improved parser for edge cases\nfunction parseCSV(text: string): Record<string, string>[] {\n  const lines = text\n    .trim()\n    .split(\"\\n\")\n    .filter((line) => line.trim().length > 0)\n\n  console.log(\"[v0] CSV lines count:\", lines.length)\n  console.log(\"[v0] First line (headers):\", lines[0])\n\n  if (lines.length === 0) {\n    console.log(\"[v0] No data found in CSV\")\n    return []\n  }\n\n  const headers = lines[0].split(\",\").map((h) => h.trim().toLowerCase())\n  console.log(\"[v0] Parsed headers:\", headers)\n\n  const records = lines.slice(1).map((line, idx) => {\n    const values = line.split(\",\").map((v) => v.trim())\n    const record: Record<string, string> = {}\n\n    headers.forEach((header, index) => {\n      record[header] = values[index] || \"\"\n    })\n\n    if (record.email) {\n      console.log(`[v0] Row ${idx + 2}: ${record.email}`)\n    }\n\n    return record\n  })\n\n  console.log(\"[v0] Total records parsed:\", records.length)\n  return records\n}\n\n// Fetch and cache CSV data\nlet cachedData: ParsedUser[] | null = null\nlet lastFetchTime = 0\nconst CACHE_DURATION = 5 * 60 * 1000 // 5 minutes\n\nexport async function fetchUsersFromCSV(): Promise<ParsedUser[]> {\n  // Return cached data if still valid\n  if (cachedData && Date.now() - lastFetchTime < CACHE_DURATION) {\n    console.log(\"[v0] Returning cached data\")\n    return cachedData\n  }\n\n  try {\n    console.log(\"[v0] Fetching CSV from:\", CSV_URL)\n    const response = await fetch(CSV_URL, { cache: \"no-store\" })\n\n    if (!response.ok) {\n      throw new Error(`Failed to fetch CSV: ${response.statusText}`)\n    }\n\n    const csvText = await response.text()\n    console.log(\"[v0] CSV response length:\", csvText.length)\n    console.log(\"[v0] First 500 chars:\", csvText.substring(0, 500))\n\n    const records = parseCSV(csvText)\n\n    cachedData = records\n      .filter((record) => record.email && record.email.length > 0)\n      .map((record) => ({\n        email: record.email || \"\",\n        password: record.password || \"\",\n        name: record.name || \"\",\n        status: (record.status?.toLowerCase() || \"offline\") as \"online\" | \"offline\" | \"busy\",\n        phone: record.contact || \"\", // Map contact column to phone field\n      }))\n\n    console.log(\"[v0] Processed users count:\", cachedData.length)\n    console.log(\"[v0] Processed users:\", cachedData)\n\n    lastFetchTime = Date.now()\n    return cachedData\n  } catch (error) {\n    console.error(\"[v0] Failed to fetch CSV:\", error)\n    return []\n  }\n}\n\n// Find user by email\nexport async function findUserByEmail(email: string): Promise<ParsedUser | undefined> {\n  const users = await fetchUsersFromCSV()\n  const found = users.find((u) => u.email.toLowerCase() === email.toLowerCase())\n  console.log(\"[v0] Finding user:\", email, \"Found:\", !!found)\n  return found\n}\n\n// Get all users\nexport async function getAllUsers(): Promise<ParsedUser[]> {\n  return fetchUsersFromCSV()\n}\n"],"names":[],"mappings":"AAAA,iDAAiD;;;;;;;;;AAEjD,MAAM,UACJ;AAmBF,+DAA+D;AAC/D,SAAS,SAAS,IAAY;IAC5B,MAAM,QAAQ,KACX,IAAI,GACJ,KAAK,CAAC,MACN,MAAM,CAAC,CAAC,OAAS,KAAK,IAAI,GAAG,MAAM,GAAG;IAEzC,QAAQ,GAAG,CAAC,yBAAyB,MAAM,MAAM;IACjD,QAAQ,GAAG,CAAC,8BAA8B,KAAK,CAAC,EAAE;IAElD,IAAI,MAAM,MAAM,KAAK,GAAG;QACtB,QAAQ,GAAG,CAAC;QACZ,OAAO,EAAE;IACX;IAEA,MAAM,UAAU,KAAK,CAAC,EAAE,CAAC,KAAK,CAAC,KAAK,GAAG,CAAC,CAAC,IAAM,EAAE,IAAI,GAAG,WAAW;IACnE,QAAQ,GAAG,CAAC,wBAAwB;IAEpC,MAAM,UAAU,MAAM,KAAK,CAAC,GAAG,GAAG,CAAC,CAAC,MAAM;QACxC,MAAM,SAAS,KAAK,KAAK,CAAC,KAAK,GAAG,CAAC,CAAC,IAAM,EAAE,IAAI;QAChD,MAAM,SAAiC,CAAC;QAExC,QAAQ,OAAO,CAAC,CAAC,QAAQ;YACvB,MAAM,CAAC,OAAO,GAAG,MAAM,CAAC,MAAM,IAAI;QACpC;QAEA,IAAI,OAAO,KAAK,EAAE;YAChB,QAAQ,GAAG,CAAC,CAAC,SAAS,EAAE,MAAM,EAAE,EAAE,EAAE,OAAO,KAAK,EAAE;QACpD;QAEA,OAAO;IACT;IAEA,QAAQ,GAAG,CAAC,8BAA8B,QAAQ,MAAM;IACxD,OAAO;AACT;AAEA,2BAA2B;AAC3B,IAAI,aAAkC;AACtC,IAAI,gBAAgB;AACpB,MAAM,iBAAiB,IAAI,KAAK,KAAK,YAAY;;AAE1C,eAAe;IACpB,oCAAoC;IACpC,IAAI,cAAc,KAAK,GAAG,KAAK,gBAAgB,gBAAgB;QAC7D,QAAQ,GAAG,CAAC;QACZ,OAAO;IACT;IAEA,IAAI;QACF,QAAQ,GAAG,CAAC,2BAA2B;QACvC,MAAM,WAAW,MAAM,MAAM,SAAS;YAAE,OAAO;QAAW;QAE1D,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,IAAI,MAAM,CAAC,qBAAqB,EAAE,SAAS,UAAU,EAAE;QAC/D;QAEA,MAAM,UAAU,MAAM,SAAS,IAAI;QACnC,QAAQ,GAAG,CAAC,6BAA6B,QAAQ,MAAM;QACvD,QAAQ,GAAG,CAAC,yBAAyB,QAAQ,SAAS,CAAC,GAAG;QAE1D,MAAM,UAAU,SAAS;QAEzB,aAAa,QACV,MAAM,CAAC,CAAC,SAAW,OAAO,KAAK,IAAI,OAAO,KAAK,CAAC,MAAM,GAAG,GACzD,GAAG,CAAC,CAAC,SAAW,CAAC;gBAChB,OAAO,OAAO,KAAK,IAAI;gBACvB,UAAU,OAAO,QAAQ,IAAI;gBAC7B,MAAM,OAAO,IAAI,IAAI;gBACrB,QAAS,OAAO,MAAM,EAAE,iBAAiB;gBACzC,OAAO,OAAO,OAAO,IAAI;YAC3B,CAAC;QAEH,QAAQ,GAAG,CAAC,+BAA+B,WAAW,MAAM;QAC5D,QAAQ,GAAG,CAAC,yBAAyB;QAErC,gBAAgB,KAAK,GAAG;QACxB,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO,EAAE;IACX;AACF;AAGO,eAAe,gBAAgB,KAAa;IACjD,MAAM,QAAQ,MAAM;IACpB,MAAM,QAAQ,MAAM,IAAI,CAAC,CAAC,IAAM,EAAE,KAAK,CAAC,WAAW,OAAO,MAAM,WAAW;IAC3E,QAAQ,GAAG,CAAC,sBAAsB,OAAO,UAAU,CAAC,CAAC;IACrD,OAAO;AACT;AAGO,eAAe;IACpB,OAAO;AACT"}},
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/VICTUS/Desktop/aaaaa/lib/auth-context.tsx"],"sourcesContent":["\"use client\"\n\nimport { createContext, useContext, useState, useEffect, type ReactNode } from \"react\"\nimport { findUserByEmail, getAllUsers } from \"./csv-service\"\n\nexport interface User {\n  id: string\n  name: string\n  email: string\n  avatar: string\n  status: \"online\" | \"offline\" | \"busy\"\n}\n\nexport interface UserContact {\n  id: string\n  userId: string\n  name: string\n  email: string\n  phone: string\n  status: \"online\" | \"offline\" | \"busy\"\n  avatar: string\n  department: string\n}\n\ninterface AuthContextType {\n  user: User | null\n  isLoading: boolean\n  login: (email: string, password: string) => Promise<void>\n  logout: () => void\n  userContacts: UserContact[]\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined)\n\nexport function AuthProvider({ children }: { children: ReactNode }) {\n  const [user, setUser] = useState<User | null>(null)\n  const [isLoading, setIsLoading] = useState(true)\n  const [userContacts, setUserContacts] = useState<UserContact[]>([])\n\n  // Check if user is already logged in on mount\n  useEffect(() => {\n    const storedUser = localStorage.getItem(\"kali_user\")\n    if (storedUser) {\n      try {\n        const parsedUser = JSON.parse(storedUser)\n        setUser(parsedUser)\n        loadUserContacts(parsedUser.email)\n      } catch {\n        localStorage.removeItem(\"kali_user\")\n      }\n    }\n    setIsLoading(false)\n  }, [])\n\n  const loadUserContacts = async (userEmail: string) => {\n    try {\n      const allUsers = await getAllUsers()\n      console.log(\"[v0] All users loaded:\", allUsers.length)\n      console.log(\"[v0] Current user email:\", userEmail)\n\n      const contactDetails = allUsers\n        .filter((u) => u.email.toLowerCase() !== userEmail.toLowerCase())\n        .map((contact) => ({\n          id: contact.email,\n          userId: userEmail,\n          name: contact.name,\n          email: contact.email,\n          phone: contact.phone,\n          status: (contact.status?.toLowerCase() || \"offline\") as \"online\" | \"offline\" | \"busy\",\n          avatar: contact.name.substring(0, 2).toUpperCase(),\n          department: \"TEAM\", // Added default department\n        }))\n\n      console.log(\"[v0] Final contacts:\", contactDetails)\n      setUserContacts(contactDetails)\n    } catch (error) {\n      console.error(\"[v0] Failed to load contacts:\", error)\n      setUserContacts([])\n    }\n  }\n\n  const login = async (email: string, password: string) => {\n    setIsLoading(true)\n    try {\n      await new Promise((resolve) => setTimeout(resolve, 500))\n\n      const csvUser = await findUserByEmail(email)\n\n      if (!csvUser || csvUser.password !== password) {\n        throw new Error(\"Invalid email or password\")\n      }\n\n      const userData: User = {\n        id: email,\n        name: csvUser.name,\n        email: csvUser.email,\n        avatar: csvUser.name.substring(0, 2).toUpperCase(),\n        status: csvUser.status,\n      }\n\n      setUser(userData)\n      await loadUserContacts(email)\n      localStorage.setItem(\"kali_user\", JSON.stringify(userData))\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  const logout = () => {\n    setUser(null)\n    setUserContacts([])\n    localStorage.removeItem(\"kali_user\")\n  }\n\n  return (\n    <AuthContext.Provider value={{ user, isLoading, login, logout, userContacts }}>{children}</AuthContext.Provider>\n  )\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext)\n  if (!context) {\n    throw new Error(\"useAuth must be used within AuthProvider\")\n  }\n  return context\n}\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;;;AAHA;;;AAgCA,MAAM,4BAAc,IAAA,8KAAa,EAA8B;AAExD,SAAS,aAAa,EAAE,QAAQ,EAA2B;;IAChE,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAc;IAC9C,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAC3C,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,yKAAQ,EAAgB,EAAE;IAElE,8CAA8C;IAC9C,IAAA,0KAAS;kCAAC;YACR,MAAM,aAAa,aAAa,OAAO,CAAC;YACxC,IAAI,YAAY;gBACd,IAAI;oBACF,MAAM,aAAa,KAAK,KAAK,CAAC;oBAC9B,QAAQ;oBACR,iBAAiB,WAAW,KAAK;gBACnC,EAAE,OAAM;oBACN,aAAa,UAAU,CAAC;gBAC1B;YACF;YACA,aAAa;QACf;iCAAG,EAAE;IAEL,MAAM,mBAAmB,OAAO;QAC9B,IAAI;YACF,MAAM,WAAW,MAAM,IAAA,uIAAW;YAClC,QAAQ,GAAG,CAAC,0BAA0B,SAAS,MAAM;YACrD,QAAQ,GAAG,CAAC,4BAA4B;YAExC,MAAM,iBAAiB,SACpB,MAAM,CAAC,CAAC,IAAM,EAAE,KAAK,CAAC,WAAW,OAAO,UAAU,WAAW,IAC7D,GAAG,CAAC,CAAC,UAAY,CAAC;oBACjB,IAAI,QAAQ,KAAK;oBACjB,QAAQ;oBACR,MAAM,QAAQ,IAAI;oBAClB,OAAO,QAAQ,KAAK;oBACpB,OAAO,QAAQ,KAAK;oBACpB,QAAS,QAAQ,MAAM,EAAE,iBAAiB;oBAC1C,QAAQ,QAAQ,IAAI,CAAC,SAAS,CAAC,GAAG,GAAG,WAAW;oBAChD,YAAY;gBACd,CAAC;YAEH,QAAQ,GAAG,CAAC,wBAAwB;YACpC,gBAAgB;QAClB,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,iCAAiC;YAC/C,gBAAgB,EAAE;QACpB;IACF;IAEA,MAAM,QAAQ,OAAO,OAAe;QAClC,aAAa;QACb,IAAI;YACF,MAAM,IAAI,QAAQ,CAAC,UAAY,WAAW,SAAS;YAEnD,MAAM,UAAU,MAAM,IAAA,2IAAe,EAAC;YAEtC,IAAI,CAAC,WAAW,QAAQ,QAAQ,KAAK,UAAU;gBAC7C,MAAM,IAAI,MAAM;YAClB;YAEA,MAAM,WAAiB;gBACrB,IAAI;gBACJ,MAAM,QAAQ,IAAI;gBAClB,OAAO,QAAQ,KAAK;gBACpB,QAAQ,QAAQ,IAAI,CAAC,SAAS,CAAC,GAAG,GAAG,WAAW;gBAChD,QAAQ,QAAQ,MAAM;YACxB;YAEA,QAAQ;YACR,MAAM,iBAAiB;YACvB,aAAa,OAAO,CAAC,aAAa,KAAK,SAAS,CAAC;QACnD,SAAU;YACR,aAAa;QACf;IACF;IAEA,MAAM,SAAS;QACb,QAAQ;QACR,gBAAgB,EAAE;QAClB,aAAa,UAAU,CAAC;IAC1B;IAEA,qBACE,6LAAC,YAAY,QAAQ;QAAC,OAAO;YAAE;YAAM;YAAW;YAAO;YAAQ;QAAa;kBAAI;;;;;;AAEpF;GAnFgB;KAAA;AAqFT,SAAS;;IACd,MAAM,UAAU,IAAA,2KAAU,EAAC;IAC3B,IAAI,CAAC,SAAS;QACZ,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT;IANgB"}}]
}